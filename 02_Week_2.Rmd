# Week 2

```{r, message=FALSE, warning=FALSE, echo=FALSE}
library(tidyverse)
library(readr)

knitr::opts_chunk$set(echo = FALSE, warning=FALSE, message=FALSE, fig.height=4)

```


### Assignments{-}

1. Read Chapter 6 and 7 from Claus Wilke's Fundamentals of Data Visualiztion [book](https://serialmentor.com/dataviz/).

2. Watch Hans Roslings [TED talk](https://www.ted.com/talks/hans_rosling_shows_the_best_stats_you_ve_ever_seen). Comment on two aspects of the videa that stand out to you regarding how he presented his data and how he talked through the visualization with the audience.

3. Graph the NOAA CO$_2$ data over time.  The Nationa Oceanic and Atmospheric Adminstration has monthly CO$_2$ atmospheric levels data available to the public at NOAA's [website](ftp://aftp.cmdl.noaa.gov/products/trends/co2/co2_mm_mlo.txt). However, this is a little obnoxious to get into Tableau, so I've done some data wrangling for you [already](https://raw.githubusercontent.com/dereksonderegger/141/master/data-raw/CO2.csv). The `Date2` column has the date information encoded using a continuous decimal scale. CO$_2$ is measured in parts per million.

    a) Plot CO$_2$ over time while showing the monthly trend. Should we use area or lines?  Why?
    b) Create a graph that shows a single mark per year (so average over all observations in a year). Do you like this better? Explain your reasoning.
    c) Create a follow-up graphic that shows the monthly trend. Explain what you want to demonstrate and why you chose to display the information as you did.
    




## Amounts

The 2020 presidential candidate field has a wide range of ages. 
The 
[New York Times](https://www.nytimes.com/interactive/2019/06/09/us/politics/2020-democractic-candidates-ages.html)
has a nice article showing the candidate ages. I grabbed a few of the most prominent candidates and pulled their birthdays from Wikipedia and then calculated their age on election day.

```{r, echo=FALSE, message=FALSE, fig.height=5}
birth <- read_csv('data-raw/Prez_Candidate_Birthdays')
ggplot(birth, aes(x=Candidate, y=AgeOnElection)) + 
  geom_point() +
  labs(x='Candidate', y='Age on Nov 3,  2020', title='Ages of Presidential Candidates') +
  coord_flip()
```

The order of the candidates is useless. Here we have ordered them alphabetically when we should try to think about an ordering that improves clarity. Lets switch to sorting the candidates by age.

```{r, echo=FALSE, message=FALSE, fig.height=5}
birth <- birth %>%
  mutate(Candidate = fct_reorder(Candidate, AgeOnElection))  
ggplot(birth, aes(x=Candidate, y=AgeOnElection, color=Party)) + 
  geom_point() +
  scale_color_manual(values=c('Blue','Red')) +
  labs(x='Candidate', y='Age on Nov 3,  2020', title='Ages of Presidential Candidates') +
  coord_flip()
```

This isn't too bad, but it fails to visually impress the differences. A bar chart should visually impress the ages based on the length of the bar so that we con't have to keep looking at the Age axis.

```{r, echo=FALSE, message=FALSE, fig.height=5}
birth %>%
  mutate(Candidate = fct_reorder(Candidate, AgeOnElection))  %>%
ggplot( aes(x=Candidate, y=AgeOnElection, fill=Party)) + 
  geom_col() +
  scale_fill_manual(values=c('Blue','Red')) +
  labs(x='Candidate', y='Age on Nov 3,  2020', title='Ages of Presidential Candidates') +
  coord_flip()
```

What would be *dishonest* is if we were to chop off the bars at 35 or 40 to make the age difference between Buttigieg and Warren, Trump, Biden and Sanders seem huge.

```{r, echo=FALSE, message=FALSE, fig.height=5}
birth <- birth %>%
  mutate(candidate = fct_reorder(Candidate, AgeOnElection))  
ggplot(birth, aes(x=Candidate, y=AgeOnElection, fill=Party)) + 
  geom_col() +
  scale_fill_manual(values=c('Blue','Red')) +
  labs(x='Candidate', y='Age on Nov 3,  2020', title='Ages of Presidential Candidates - WRONG!') +
  coord_flip(ylim=c(35,80)) 
```


Often we need to graph some value and want to know how it varies among *two* different categories. In these cases, we have to employ some sort of grouping strategy.

```{r}
data('gapminder', package='gapminder')
G7 <- c('United States', 'Canada', 'France', 'United Kingdom', 'Germany', 'Italy', 'Japan')
gapminder <- gapminder %>%
  filter( country %in%  G7) %>%
  mutate( decade = cut(year, breaks = seq(1950, 2010, by=10), right=FALSE, labels = paste(seq(1950,2000,by=10),'s',sep='')))

gapminder %>%
  group_by(continent, country, decade) %>%
  summarize(lifeExp = median(lifeExp)) %>% 
  filter(decade == '2000s') %>%
  ungroup() %>%
  mutate(country = fct_reorder(country, desc(lifeExp) )) %>%
ggplot(., aes(x=country, y=lifeExp)) +
  geom_col() +
  labs(title='Life Expectancy among G7 Countries in 2007', y='Life Expectancy')
```

The bar chart here is obscuring the differences in life expectancies because the numbers are so close. In this case, I think points make more sense. Also I want to see how life expectancy has changed since World War II.


```{r}
data('gapminder', package='gapminder')
gapminder <- gapminder %>% filter( country %in%  G7) %>%
  mutate(country = fct_relevel(country, c('Japan','Italy','Canada','France','Germany','United Kingdom', 'United States' )) )

ggplot(gapminder, aes(x=year, y=lifeExp)) +
  geom_point() + geom_line() +
  facet_grid( . ~ country) +
 scale_x_continuous(breaks = seq(1950, 2010,  by=20)) + 
  labs(title='Life Expectancy among G7 Countries (1950 - 2007)', y='Life Expectancy',
       x='') 
```

In the above graph, I am grouping countries both by enclosure and with a physical path connection. The reader tends to see the line as a whole object and compare the line max/min and slope among the seven countries. 

We might consider changing the faceting to stack the countries, but this makes it much harder to compare countries to see which has a higher life expectancy.
```{r}
data('gapminder', package='gapminder')
gapminder <- gapminder %>% filter( country %in%  G7) %>%
  mutate(country = fct_relevel(country, c('Japan','Italy','Canada','France','Germany','United Kingdom', 'United States' )) )

ggplot(gapminder, aes(x=year, y=lifeExp)) +
  geom_point() + geom_line() +
  facet_grid( country ~ . ) +
 scale_x_continuous(breaks = seq(1950, 2010,  by=20)) + 
  labs(title='Life Expectancy among G7 Countries (1950 - 2007)', y='Life Expectancy',
       x='') 
```


A heat map makes it easier to see which country has the highest life expectancy, but we lose precision in the actual values.
```{r}
gapminder %>%
  mutate(country = fct_relevel(country, c('Japan','Italy','Canada','France','Germany','United Kingdom', 'United States' )) )%>%
  mutate(country = fct_rev(country)) %>%
ggplot(., aes( x=year, y=country, fill=lifeExp) ) +
  geom_tile() +
  scale_fill_gradient2(midpoint=73) +
  #scale_fill_gradient(low='red', high='blue')
  labs(title='Life Expectancy among G7 Countries (1950 - 2007)', fill='Life Expectancy',
       x='', y='') 
```



## Distributions

Given a single variable, I often want to know what values are common and what values are rare. To visualize this, we will primarily compare marks along a common axis (the most accurate EPT!)

### Small samples
If we only have a few observations, then we can just graph them along an axis.

```{r, fig.height=1.5}
data('birthwt', package='MASS')
birthwt <- birthwt %>%
  mutate( smoke = ifelse( smoke==0, 'Non-smoker', 'Smoker' ) ) 

birthwt %>%
  slice(1:10) %>%
  ggplot(., aes(x=bwt)) +
  geom_point(aes(x=bwt), y=0) +
  labs( x='Birthweight (g)', y='', title='Strip plot: Infant Birthweight') +
  scale_y_continuous(breaks=NULL)
```

Another trick that works with more data, is to not use dots but rather lines. This is called a rugplot. This is often used in conjunction with another graph such as a scatterplot.
```{r, fig.height=2}
birthwt %>%
  slice(1:10) %>%
  ggplot(., aes(x=bwt)) +
  geom_rug() +
  labs( x='Birthweight (g)', y='', title='Rug plot: Infant Birthweight')
```


### Histograms
When we have a moderate size of data, graphing dots exactly on an axis doesn't work and results in overplotting and it is difficult to see where the data cluster. Instead we'll stack the dots in columns along the axis and call this a dotplot.

```{r}
birthwt %>%
  ggplot(., aes(x=bwt)) +
  geom_dotplot( dotsize=.7 ) +
  labs( x='Birthweight (g)', title='Dot plot: Infant Birthweight', y='') +
  scale_y_continuous(breaks=NULL)
```

Each dot represents an observation, but the x-values have been rounded into group values. So we have lost some precision. Another common version of this is a histogram, where the y-axis represents how many observations fall into each bin.

```{r}
birthwt %>% ggplot(., aes(x=bwt)) +
  geom_histogram( bins=30, color='black', fill='grey70' ) +
  labs( x='Birthweight (g)', title='Histogram: Infant Birthweight')
```

The choice of how many bins to include can make a dramatic difference in a graph. In particular, I don't believe that there is any biological reason to think the dip near 2700 grams is real. I believe that is is actually just an artifact of the data I have. Instead we should consider changing the number of bins.

```{r}
A <- birthwt %>% ggplot(., aes(x=bwt)) +
  geom_histogram( bins=30, color='black', fill='grey70' ) +
  labs( x='Birthweight (g)', title='Infant Birthweight') +
  geom_label(x=1200, y=15, label='bins = 30')
B <- birthwt %>% ggplot(., aes(x=bwt)) +
  geom_histogram( bins=14, color='black', fill='grey70' ) +
  labs( x='Birthweight (g)', title='Infant Birthweight')+
  geom_label(x=1000, y=30, label='bins = 14')
C <- birthwt %>% ggplot(., aes(x=bwt)) +
  geom_histogram( bins=9, color='black', fill='grey70' ) +
  labs( x='Birthweight (g)', title='Infant Birthweight')+
  geom_label(x=1000, y=45, label='bins = 9')
D <- birthwt %>% ggplot(., aes(x=bwt)) +
  geom_histogram( bins=4, color='black', fill='grey70' ) +
  labs( x='Birthweight (g)', title='Infant Birthweight')+
  geom_label(x=0, y=100, label='bins = 4')

cowplot::plot_grid(A,B,C,D)
```



### Density plots
Histograms suffer from being to angular or pointy. Another solution is call a kernel density smoother that mathematically smooths over the heights of the histogram bars.
```{r}
birthwt %>% ggplot(., aes(x=bwt, y=..density..)) +
  geom_histogram( bins=30, color='black', fill='grey70',  ) +
  geom_density(fill='cornsilk', alpha=.5) +
  labs( x='Birthweight (g)', title='Histogram + Density plots: Infant Birthweight') 
```


### Faceting
One of my favorite ways to display multiple distributions is to group each distribution into it's own plot in a process often referred to as faceting.

```{r}

A <- ggplot(birthwt, aes(x=bwt, fill=smoke)) +
  geom_density(position='stack') +
  labs( x='Birthweight (g)', title='Density plot: Infant Birthweight', y='') +
  scale_y_continuous(breaks=NULL) +
  facet_grid( . ~ smoke ) +
  theme( legend.position = 'None')
B <- ggplot(birthwt, aes(x=bwt, fill=smoke)) +
  geom_density(position='stack') +
  labs( x='Birthweight (g)', title='Density plot: Infant Birthweight', y='') +
  scale_y_continuous(breaks=NULL) +
  facet_grid( smoke ~ . )

cowplot::plot_grid(A,B, labels = c('A','B'))
```

By choosing to put the two graphs on top of the other, it becomes clear that the smoker's tend to give birth to smaller infants. This fact isn't clear in the side-by-side graphs.


### Stacking

Stacking the distribution involes laying each distribution on top of each other, so that the zero of the top curve follows the curve on the bottom. You can visualize the B chart having the Non-smoker density graph just melt onto the smoker density.

```{r}
ggplot(birthwt, aes(x=bwt, fill=smoke)) +
  geom_density(position='stack') +
  labs( x='Birthweight (g)', title='Stacked Density plots: Infant Birthweight', y='') +
  scale_y_continuous(breaks=NULL) 
```
I really don't like this graph because it is very hard to see where the peak of the non-smoker curve is. This stacking trick works well enough when we have proportions but isn't good here.



### Overlapping curves
Another option is to graph the densities, but allow them to overlap each other and be a bit see-thru.
```{r}
annotation.data <- data.frame(
  bwt=c(4500, 1500),
  y = c(5e-4, 5e-4),
  smoke = c('Non-smoker', 'Smoker'))
ggplot(birthwt, aes(x=bwt, fill=smoke)) +
  geom_density(position='identity', alpha=.5) +
  labs( x='Birthweight (g)', title='Overlaped Density plots: Infant Birthweight', y='') +
  scale_y_continuous(breaks=NULL) +
  geom_label( data=annotation.data, aes(y=y, label=smoke), alpha=.5) +
  theme(legend.position = 'None')
```

For seeing shifts in the center of the distribution, overlapping curves is quite powerful.

For another nice example, we can look at the density of the daily maximum temperature in Lincoln Nebraska in 2016.
```{r}
library(ggridges)
ggplot(lincoln_weather, aes(x = `Max Temperature [F]`, y = `Month`)) +
  geom_density_ridges_gradient(aes(fill = ..x..), scale = 3, size=.4, alpha=.2) +
  scale_fill_gradientn(colors=c('blue','purple','red'), values = c(0,.7, 1)) +
  # scale_fill_gradientn(
  #   colours = c("#0D0887FF", "#CC4678FF", "#F0F921FF"),
  #   name = "Temp. [F]")+
  labs(title = 'Ridge plot: Temperatures in Lincoln NE, 2016') 
```


### Boxplots
Boxplots are a traditional way to display a distribution and the box contains the middle 50% of the data points.
```{r}
ggplot(lincoln_weather, aes(x=Month, y=`Max Temperature [F]`)) +
  geom_boxplot() +
  coord_flip() +
    labs(title = 'Box plots: Temperatures in Lincoln NE, 2016') 

```
Notice that in density plots, there were two peaks in December with the lower peak corresponding to a cold snap. However that detail is lost in the boxplots.

### Violin Plots
Boxplots are a traditional way to display a distribution and the box contains the middle 50% of the data points.
```{r, fig.height=4}
ggplot(lincoln_weather, aes(x=Month, y=`Max Temperature [F]`)) +
  geom_violin() +
  coord_flip() +
    labs(title = 'Violin plots: Temperatures in Lincoln NE, 2016') 

```
Now we can see the two peaks in December, but the three peaks in November have been flattened out because the amount of space necessary to show it would require that the densities overlap.


## Proportions

A good pie chart from [reddit/r/dataisbeautiful](https://www.reddit.com/r/dataisbeautiful/comments/cz58sb/blood_type_distribution_in_the_united_states_oc/) member `u/foiltape`.

![A Good Pie Chart](Resources/Graphs/Pie_Charts/BloodTypes.png)







