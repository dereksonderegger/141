# Amounts


```{r, warning=FALSE, message=FALSE, echo=FALSE}
# Un-attach any packages that happen to already be loaded. In general this is unnecessary
# but is important for the creation of the book to not have package namespaces
# fighting unexpectedly.
pkgs = names(sessionInfo()$otherPkgs)
if( length(pkgs > 0)){
  pkgs = paste('package:', pkgs, sep = "")
  for( i in 1:length(pkgs)){
    detach(pkgs[i], character.only = TRUE, force=TRUE)
  }
}

# Chapter packages we will use
library(tidyverse)
library(cowplot)

# Don't show the R code!
knitr::opts_chunk$set(echo = FALSE)

```

## Introduction
This chapter focuses on displaying a single numerical variable versus one or more categorical variables. To display the quantitative variable, we'll try to stay at the top of the EPT tasks and the quantitative variable will be quantified with either the `x` or `y` axis or using length. The exception to this is the heatmap, where the quantitative variable is encoded by the color of the tile.

```{r, echo=FALSE}
data <- tribble(
  ~Quant, ~Cat1, ~Cat2,
  3,  'A', 'W',
  2,  'A', 'X',
  3,  'A', 'Z',
  4,  'B', 'W',
  4,  'B', 'X',
  5,  'B', 'Z',
  2,  'C', 'W',
  3,  'C', 'X',
  4,  'C', 'Z')

P1 <- 
  data %>%
  group_by(Cat1) %>% summarise(Quant = sum(Quant)) %>%
  ggplot(aes(x=Cat1, y=Quant)) + 
  geom_point() + 
  theme_cowplot() +
  theme(axis.ticks.x = element_blank(),
        axis.title = element_blank(),
        axis.text = element_blank() ) +
  labs(title='Points')

P2 <- 
  data %>%
  group_by(Cat1) %>% summarise(Quant = sum(Quant)) %>%
  ggplot(aes(x=Cat1, y=Quant, fill=Cat1)) + 
  geom_col() +
  theme_cowplot() +
  theme(axis.ticks.x = element_blank(),
        axis.title = element_blank(),
        axis.text = element_blank(),
        legend.position = 'none') +
  labs(title='Bars')


no_label <- as_labeller( function(input){ ifelse(input=='G1', ' ', '  ')} )
P3 <- 
  data %>%
  ggplot(aes(x=Cat1, y=Quant, fill=Cat1)) + 
  geom_col() + facet_grid(.~Cat2, labeller=no_label) +
  theme_cowplot() +
  theme(axis.ticks.x = element_blank(),
        axis.title = element_blank(),
        axis.text = element_blank(),
        legend.position = 'none') +
  labs(title='Grouped Bars')


P4 <- 
  data %>%
  ggplot(aes(x=Cat2, y=Quant, fill=Cat1)) + 
  geom_col() + 
  theme_cowplot() +
  theme(axis.ticks.x = element_blank(),
        axis.title = element_blank(),
        axis.text = element_blank(),
        legend.position = 'none') +
  labs(title='Stacked Bars')


P5 <-   
  data %>%
  ggplot(aes(x=Cat1, y=Cat2, fill=Quant)) + 
  geom_tile() + 
  theme_cowplot() +
  theme(axis.ticks.x = element_blank(),
        axis.title = element_blank(),
        axis.text = element_blank(),
        legend.position = 'none') +
  labs(title='Heat Map')

cowplot::plot_grid(P1, P2, P3, P4, P5, ncol = 2)
```

## Example 1
The 2020 presidential candidate field has a wide range of ages. 
The 
[New York Times](https://www.nytimes.com/interactive/2019/06/09/us/politics/2020-democractic-candidates-ages.html)
has a nice article showing the candidate ages. I grabbed a few of the most prominent candidates and pulled their birthdays from Wikipedia and then calculated their age on election day. As usual the data is [available](https://raw.githubusercontent.com/dereksonderegger/141/master/data-raw/Prez_Candidate_Birthdays) on the Github pages for this book. 

```{r, echo=FALSE, message=FALSE, fig.height=5}
birth <- read_csv('data-raw/Prez_Candidate_Birthdays')
ggplot(birth, aes(x=Candidate, y=AgeOnElection)) + 
  geom_point() +
  labs(x='Candidate', y='Age on Nov 3,  2020', title='Ages of Presidential Candidates') +
  coord_flip()
```

The order of the candidates is useless. Here we have ordered them alphabetically when we should try to think about an ordering that improves clarity. Lets switch to sorting the candidates by age.

```{r, echo=FALSE, message=FALSE, fig.height=5}
birth <- birth %>%
  mutate(Candidate = fct_reorder(Candidate, AgeOnElection))  
ggplot(birth, aes(x=Candidate, y=AgeOnElection, color=Party)) + 
  geom_point() +
  scale_color_manual(values=c('Blue','Red')) +
  labs(x='Candidate', y='Age on Nov 3,  2020', title='Ages of Presidential Candidates') +
  coord_flip()
```

This isn't too bad, but it fails to visually impress the differences. A bar chart should visually impress the ages based on the length of the bar so that we don't have to keep looking at the Age axis.

```{r, echo=FALSE, message=FALSE, fig.height=5}
birth %>%
  mutate(Candidate = fct_reorder(Candidate, AgeOnElection))  %>%
ggplot( aes(x=Candidate, y=AgeOnElection, fill=Party)) + 
  geom_col() +
  scale_fill_manual(values=c('Blue','Red')) +
  labs(x='Candidate', y='Age on Nov 3,  2020', title='Ages of Presidential Candidates') +
  coord_flip()
```

What would be *dishonest* is if we were to chop off the bars at 35 or 40 to make the age difference between Buttigieg and Warren, Trump, Biden and Sanders seem huge.

```{r, echo=FALSE, message=FALSE, fig.height=5}
birth <- birth %>%
  mutate(candidate = fct_reorder(Candidate, AgeOnElection))  
ggplot(birth, aes(x=Candidate, y=AgeOnElection, fill=Party)) + 
  geom_col() +
  scale_fill_manual(values=c('Blue','Red')) +
  labs(x='Candidate', y='Age on Nov 3,  2020', title='Ages of Presidential Candidates - WRONG!') +
  coord_flip(ylim=c(35,80)) 
```


## Example 2

In this section we'll consider two categories. We have the results from a survey administered to students in an introductory statistics class at a New York university. We'll compare the number of student responses broken down by year in school and gender.

```{r}
data('StudentSurvey', package='Lock5Data')
StudentSurvey %>%
  filter(Year != '') %>%
  mutate(Year = fct_relevel(Year, 'FirstYear','Sophomore','Junior','Senior')) %>%
  group_by(Year, Gender) %>% count() %>%
  ggplot( aes(x=Gender, fill=Year, y=n)) +
  geom_col() +
  labs(y='Number of Surveys')
```

The first thing I notice is that there is approximate gender equality, but there are a few more males in class. After a more detailed look, I see that the most abundant class is sophomores, followed by first years, and juniors and seniors are approximately equally abundant. If we switch the grouping order and use color to denote gender and columns to denote the classes, the abundance of sophomores is the first insight to be noticed.

```{r}
StudentSurvey %>%
  filter(Year != '') %>%
  mutate(Year = fct_relevel(Year, 'FirstYear','Sophomore','Junior','Senior')) %>%
  group_by(Year, Gender) %>% count() %>%
  ggplot( aes(x=Year, fill=Gender, y=n)) +
  geom_col() +
  labs(y='Number of Surveys')
```

## Tableau Toolbox
<iframe width="560" height="315" src="https://www.youtube.com/embed/KOAgy0oIY14" frameborder="0" allowfullscreen></iframe>

<iframe width="560" height="315" src="https://www.youtube.com/embed/Fd8Y1MoKvqc" frameborder="0" allowfullscreen></iframe>

<iframe width="560" height="315" src="https://www.youtube.com/embed/AaP8n9TdLyI" frameborder="0" allowfullscreen></iframe>

<iframe width="560" height="315" src="https://www.youtube.com/embed/Tke-hgmfMNs" frameborder="0" allowfullscreen></iframe>


## Example 3

Often we need to graph some value and want to know how it varies among *two* different categories. In these cases, we have to employ some sort of grouping strategy.

```{r, echo=FALSE}
data('gapminder', package='gapminder')
G7 <- c('United States', 'Canada', 'France', 'United Kingdom', 'Germany', 'Italy', 'Japan')
gapminder <- gapminder %>%
  filter( country %in%  G7) %>%
  mutate( decade = cut(year, breaks = seq(1950, 2010, by=10), right=FALSE, labels = paste(seq(1950,2000,by=10),'s',sep='')))

gapminder %>%
  group_by(continent, country, decade) %>%
  summarize(lifeExp = median(lifeExp)) %>% 
  filter(decade == '2000s') %>%
  ungroup() %>%
  mutate(country = fct_reorder(country, desc(lifeExp) )) %>%
ggplot(., aes(x=country, y=lifeExp)) +
  geom_col() +
  labs(title='Life Expectancy among G7 Countries in 2007', y='Life Expectancy')
```

The bar chart here is obscuring the differences in life expectancies because the numbers are so close. In this case, I think points make more sense. Also I want to see how life expectancy has changed since World War II.


```{r, echo=FALSE}
ggplot(gapminder, aes(x=year, y=lifeExp)) +
  geom_point() + geom_line() +
  facet_grid( . ~ country) +
 scale_x_continuous(breaks = seq(1950, 2010,  by=20)) + 
  labs(title='Life Expectancy among G7 Countries (1950 - 2007)', y='Life Expectancy',
       x='') 
```

In the above graph, I am grouping countries both by enclosure and with a physical path connection. The reader tends to see the line as a whole object and compare the line max/min and slope among the seven countries. 

We might consider changing the faceting to stack the countries, but this makes it much harder to compare countries to see which has a higher life expectancy.
```{r, echo=FALSE}
data('gapminder', package='gapminder')
gapminder <- gapminder %>% filter( country %in%  G7) %>%
  mutate(country = fct_relevel(country, c('Japan','Italy','Canada','France','Germany','United Kingdom', 'United States' )) )

ggplot(gapminder, aes(x=year, y=lifeExp)) +
  geom_point() + geom_line() +
  facet_grid( country ~ . ) +
 scale_x_continuous(breaks = seq(1950, 2010,  by=20)) + 
  labs(title='Life Expectancy among G7 Countries (1950 - 2007)', y='Life Expectancy',
       x='') 
```

We could have also used color to indicate which country is which, but this produces a bit of a *spaghetti plot* and is difficult to interpret. However, it is easier to identify when Japan's life expectancy surpaced the rest of the G7 countries.
```{r}
gapminder %>%
  ggplot(aes(x=year, y=lifeExp, color=country)) +
  geom_point() + geom_line() +
  labs(title='Life Expectancy among G7 Countries (1950 - 2007)', 
       y='Life Expectancy',
       x='',
       color = '')  
```


A heat map makes it easier to see which country has the highest life expectancy, but we lose precision in the actual values.
```{r}
gapminder %>%
  mutate(country = fct_relevel(country, c('Japan','Italy','Canada','France','Germany','United Kingdom', 'United States' )) )%>%
  mutate(country = fct_rev(country)) %>%
ggplot(., aes( x=year, y=country, fill=lifeExp) ) +
  geom_tile() +
  scale_fill_gradient2(midpoint=73) +
  #scale_fill_gradient(low='red', high='blue')
  labs(title='Life Expectancy among G7 Countries (1950 - 2007)', fill='Life Expectancy',
       x='', y='') 
```



## Exercises

1. 


