# Principles of Graphing


```{r, echo=FALSE, warning=FALSE, message=FALSE}
# Unattach any packages that happen to already be loaded. In general this is unecessary
# but is important for the creation of the book to not have package namespaces
# fighting unexpectedly.
pkgs = names(sessionInfo()$otherPkgs)
if( length(pkgs > 0)){
  pkgs = paste('package:', pkgs, sep = "")
  for( i in 1:length(pkgs)){
    detach(pkgs[i], character.only = TRUE, force=TRUE)
  }
}

library(tidyverse) # dplyr, tidyr, ggplot2, etc.
library(ggrepel)

knitr::opts_chunk$set(echo = FALSE)
```


## Elementary Perception Tasks

* Some Visual tasks are easier than others because our visual processing evolved to do certain tasks.

![From Alberto Cairo's "The Truthful Art"](./Resources/Alberto Cairo/EPT.png)



## Groupings / Gestalt

The way we organize our graphics can lead a viewer to create mental groups of marks.

The way we form groupings can be in one of the following ways, (where higher grouping methods produce a stronger grouping effect.

* Enclosures
* Connections
* Proximity
* Similarity (color/shape)


In the following example, find all the fives:
```{r, fig.height=4, fig.width=7}
seed <- runif(1, 0,1e7) %>% round();
seed <- 1863486
set.seed(seed)
n <- 40
fives <- data.frame(x=runif(n), y=runif(n), label = runif(n, 0,10) %>% floor()) %>%
  mutate(Group = label == 5)

ggplot(fives, aes(x=x, y=y, label=label)) +
  geom_text_repel() +
  theme_bw() +
  scale_x_continuous(breaks=NULL) +
  scale_y_continuous(breaks=NULL) +
  labs(y=NULL, x=NULL)
```

If instead, we form a grouping by adding color, then the group of fives stands out prominently.
```{r, fig.height=4, fig.width=7}
ggplot(fives, aes(x=x, y=y, label=label, color=Group)) +
  geom_text_repel() +
  theme_bw() +
  scale_color_manual( values = c('black','red')) + 
  scale_x_continuous(breaks=NULL) +
  scale_y_continuous(breaks=NULL) +
  theme(legend.position = 'none') +
  labs(y=NULL, x=NULL)
```


### Grouping Examples

In the following examples, ask yourself what the visual grouping the graph is encouraging? Are the rows or columns grouped?

```{r, fig.height=4}
expand.grid(x=1:4, y=1:4) %>%
  mutate(group=ifelse(y %in% c(2,4), 'G1', 'G2')) %>%
  ggplot(aes(x=x, y=y, shape=group)) +
  geom_point(size=16) +
  theme_bw() + 
  scale_x_continuous(breaks=NULL, limits = c(-.5, 5.5)) +
  scale_y_continuous(breaks=NULL, limits = c(.5, 4.5)) +
  theme(legend.position = 'none') +
  labs(y=NULL, x=NULL)
```

```{r, fig.height=4}
expand.grid(x=1:4, y=1:4) %>%
  mutate(group=ifelse(x %in% c(2,4), 'G1', 'G2')) %>%
  ggplot(aes(x=x, y=y, color=group)) +
  geom_point(size=16) +
  theme_bw() + 
  scale_x_continuous(breaks=NULL, limits = c(-.5, 5.5)) +
  scale_y_continuous(breaks=NULL, limits = c(.5, 4.5)) +
  theme(legend.position = 'none') +
  labs(y=NULL, x=NULL)
```

```{r, fig.height=4}
expand.grid(x=1:4*2, y=1:4) %>%
  mutate(group='G1') %>%
  ggplot(aes(x=x, y=y, color=group)) +
  geom_point(size=16) +
  theme_bw() + 
  scale_x_continuous(breaks=NULL, limits = c(1.5, 8.5)) +
  scale_y_continuous(breaks=NULL, limits = c(.5, 4.5)) +
  theme(legend.position = 'none') +
  labs(y=NULL, x=NULL)
```

```{r, fig.height=4}
expand.grid(x=1:4, y=1:4) %>%
  mutate(group=paste('G', y, sep='')) %>%
  ggplot(aes(x=x, y=y, group=group)) +
  geom_point(size=16) +
  geom_line() +
  theme_bw() + 
  scale_x_continuous(breaks=NULL, limits = c(-.5, 5.5)) +
  scale_y_continuous(breaks=NULL, limits = c(.5, 4.5)) +
  theme(legend.position = 'none') +
  labs(y=NULL, x=NULL)
```

```{r, fig.height=4}
no_label <- as_labeller( function(input){ ifelse(input=='G1', ' ', '  ')} )
expand.grid(x=1:2, y=1:4, group=c('G1','G2')) %>%
  ggplot(aes(x=x, y=y, group=group)) +
  geom_point(size=16) +
  facet_grid(.~group, labeller=no_label) +
  theme_bw() + 
  scale_x_continuous(breaks=NULL, limits = c(.5, 2.5)) +
  scale_y_continuous(breaks=NULL, limits = c(.5, 4.5)) +
  theme(legend.position = 'none') +
  labs(y=NULL, x=NULL)
```


Some grouping is stronger than others

```{r, fig.height=4}
expand.grid(x=1:4, y=1:4) %>%
  mutate(group=paste('G', y, sep='')) %>%
  mutate(shape_group = ifelse(x %in% c(1,3), 'S1','S2')) %>%
  ggplot(aes(x=x, y=y, group=group)) +
  geom_point(mapping = aes(shape=shape_group), size=16, ) +
  geom_line() +
  theme_bw() + 
  scale_x_continuous(breaks=NULL, limits = c(-.5, 5.5)) +
  scale_y_continuous(breaks=NULL, limits = c(.5, 4.5)) +
  theme(legend.position = 'none') +
  labs(y=NULL, x=NULL)
```

```{r, fig.height=4}
no_label <- as_labeller( function(input){ ifelse(input=='G1', ' ', '  ')} )
expand.grid(x=1:2, y=1:4, group=c('G1','G2')) %>%
  mutate(shape_group = ifelse(x %in% c(1,3), 'S1','S2')) %>%
  ggplot(aes(x=x, y=y, group=group)) +
  geom_point(aes(shape=shape_group), size=16) +
  facet_grid(.~group, labeller=no_label) +
  theme_bw() + 
  scale_x_continuous(breaks=NULL, limits = c(.5, 2.5)) +
  scale_y_continuous(breaks=NULL, limits = c(.5, 4.5)) +
  theme(legend.position = 'none') +
  labs(y=NULL, x=NULL)
```



### Example: Warpbreaks
While spinning wool into thread, if the tension on the wool isn't correctly set, the thread can break. Here we compare two different types of wool at three different tensions.

```{r, echo=FALSE, fig.height=3, warning=FALSE, message=FALSE}
library(ggplot2)
library(dplyr)
means <- warpbreaks %>% group_by(tension, wool) %>% 
  summarize(breaks=mean(breaks))
                                                              
ggplot( warpbreaks, aes(x=tension, y=breaks, shape=wool)) +
  geom_point() +
  ggtitle( "Can't easily distiguish wool types.")
  
ggplot( warpbreaks, aes(x=tension, y=breaks, shape=wool, color=wool)) +
  geom_point() +
  ggtitle( "Can't see the trend.")

ggplot( warpbreaks, aes(x=tension, y=breaks, color=wool)) +
  geom_point(aes(shape=wool)) +
  geom_line(data=means, aes(x=as.numeric(tension), y=breaks)) +
  ggtitle( "Adding connections between means, the trend is clear")

ggplot( warpbreaks, aes(x=tension, y=breaks, color=wool)) +
  geom_point(aes(shape=wool)) +
  geom_line(data=means, aes(x=as.numeric(tension), y=breaks)) +
  facet_grid(. ~ wool) +
  ggtitle( "Trend is clear, but magnitude is harder")

ggplot( warpbreaks, aes(x=tension, y=breaks, color=wool)) +
  geom_point(aes(shape=wool)) +
  geom_line(data=means, aes(x=as.numeric(tension), y=breaks)) +
  facet_grid(wool ~ .) +
  ggtitle( "Non-Aligned y-axis is worse")

```


## "Color" Scales

Defining Color really has three different attributes (From [Wikipedia](https://en.wikipedia.org/wiki/HSL_and_HSV)).

#### HSV Scale
* Hue: The attribute of a visual sensation according to which an area appears to be similar to one of the perceived colors: red, yellow, green, and blue, or to a combination of two of them.
* Saturation: The "colorfulness of a stimulus relative to its own brightness"
* Value: The "brightness relative to the brightness of a similarly illuminated white"

![HSV Cylinder from Wikipedia](./Resources/Wikipedia/HSV_color_solid_cylinder_saturation_gray.png)

* Hue is appropriate for categorical variables.
* Saturation and/or Value is appropriate for a quantitative variable scale.

Neither R nor Tableau make it particularly easy to map these aspects, so we won't get too deep into it.


