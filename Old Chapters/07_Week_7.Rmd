# Week 7

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning=FALSE, message=FALSE)
```
```{r}
library(tidyverse)
```

## Maternity Deaths

Suppose that we are interested the mortality rates that women experience related to pregnancy and birth.

Step One: Variable of interest
Clearly we want to have some sort rate adjustment to account for different population sizes. However, because not all women give birth, we shouldn't just consider all women. Instead we'll consider this maternal deaths per 100,000 live births. 

Step Two: Context
Approximately 700 women per year die due to complications of pregnancy or child birth in the United States. This turns out to be ~17.2 deaths per 100,000 births, or about 1 maternal death per 5,000 live births. 

Step Three: Conditional Statistics
  - How does this vary between countries?
  - How does this vary between states?
  - How does this vary between socio-economic or ethic groups?
  

### Step Four: Finding Data
  - Typically it is easy to google for a single statistic for a country. However, it is often difficult to find a dataset that allows for the conditional statistics, such as between states or ethnic groups.
  - I found data from the Centers for Disease Control. 
  
Maternal Deaths: The CDC's [Wonder](https://wonder.cdc.gov) on-line access allows you to format data requests for a wide variety of scenarios.
  - Tried to get Maternal Deaths by State by Year. However, the CDC won't release that. The reason is that from an ethical standpoint, government cannot risk exposing information for any individual. So all government agencies will only release data that has been aggregated to a point where they are certain that individuals cannot be identified.
  - Year by race? That was successful. 
```{r}
MM <- read_csv('data-raw/Maternal_Death/PregnancyDeaths_By_Race_by_Time.csv') %>%
  mutate(Race = fct_recode(`Race`, 
                            Native='American Indian or Alaska Native',
                            Asian = 'Asian or Pacific Islander',
                            Black = 'Black or African American'),
         Hispanic = fct_recode(`Hispanic Origin`,
                               Hispanic = 'Hispanic or Latino',
                               `Not Hispanic` = 'Not Hispanic or Latino')) %>%
  select(-Rate, -`Hispanic Origin`)

MM %>% head()
```
  
How do we get number of births? Again we get information from the CDC *Wonder* data base access. 
```{r}
Births <- read_csv('data-raw/Maternal_Death/Natality_by_Race_2007-2018.csv') %>%
  mutate(Race = fct_recode(`Mother's Bridged Race`, 
                            Native='American Indian or Alaska Native',
                            Asian = 'Asian or Pacific Islander',
                            Black = 'Black or African American'),
         Hispanic = fct_recode(`Mother's Hispanic Origin`,
                               Hispanic = 'Hispanic or Latino',
                               `Not Hispanic` = 'Not Hispanic or Latino',
                               Unknown = 'Unknown or Not Stated')) %>%
  select( -`Mother's Bridged Race`, -`Mother's Hispanic Origin` )
Births %>% head()
```


### Univariate Exploratory Graphing
I can't help but look at how the birth numbers in the US have changed over time.
```{r, fig.height=3}
Births %>%
  group_by(Year) %>%
  summarize(Births = sum(Births)) %>%
  ggplot(aes(x=Year, y=Births)) + geom_line() +
  labs(y='Number of Births', title = 'US Births over Time')

Births %>%
  group_by(Year, Race ) %>%
  summarize(Births = sum(Births)) %>%
  ggplot( aes(x=Year, y=Births) ) +
  geom_line() +
  facet_grid( Race ~ ., scales = 'free_y' ) 
```


Finally we can calculate Deaths per 100,000 births.
```{r}
data_race <- 
  inner_join(Births, MM) %>%
  group_by(Year, Race) %>% summarize(Deaths=sum(Deaths), Births=sum(Births)) %>%
  mutate( Mort_Rate = Deaths / Births * 100000 ) %>%
  select(Year, Race, Deaths, Births, Mort_Rate)

data_hispanic <- 
  inner_join(Births, MM) %>%
  group_by(Year, Hispanic) %>% summarize(Deaths=sum(Deaths), Births=sum(Births)) %>%
  mutate( Mort_Rate = Deaths / Births * 100000 ) %>%
  select(Year, Hispanic, Deaths, Births, Mort_Rate)
```

```{r}
text.df <- tribble(
  ~Year, ~Mort_Rate,  ~Race,
  2016,  57, 'Black',
  2016,  39, 'Native',
  2016,  28, 'White',
  2016,  14, 'Asian')

data_race %>% ungroup() %>%
  mutate(Year = as.integer(Year)) %>%
  ggplot(aes(x=Year, y=Mort_Rate, color=Race)) +
  geom_line(alpha=.5) +
  geom_smooth(se = FALSE, method = "gam", formula = y ~ s(x, bs = "cs")) +
  geom_label(data=text.df, aes(label=Race)) +
  theme(legend.position = "none") +
  scale_x_continuous(breaks=seq(2007,2017,by=2)) +
  labs(y='Maternal Morality (Deaths per 100,000 births)', title='Maternal Mortality by Race')
```

```{r}
text.df <- tribble(
  ~Year, ~Mort_Rate,  ~Hispanic,
  2016,  23, 'Hispanic',
  2016,  32, 'Not Hispanic')

data_hispanic %>% ungroup() %>%
  mutate(Year = as.integer(Year)) %>%
  ggplot(aes(x=Year, y=Mort_Rate, color=Hispanic)) +
  geom_line(alpha=.5) +
  geom_smooth(se = FALSE, method = "gam", formula = y ~ s(x, bs = "cs")) +
  geom_label(data=text.df, aes(label=Hispanic)) +
  theme(legend.position = "none") +
  scale_x_continuous(breaks=seq(2007,2017,by=2)) +
  labs(y='Maternal Morality (Deaths per 100,000 births)', title='Maternal Mortality by Hispanic Origin')
```


Finally we'll look at US vs rest of the world. 

```{r}
library(maps)
World_data <-  
  read_csv('data-raw/Maternal_Death/maternal_mortality_ratio_who.csv') %>% 
  mutate(country = fct_recode(country, USA = 'United States', UK = 'United Kingdom')) %>%
  select(country, `2010`) %>% rename(Mort_Rate=`2010`, region='country') %>%
  full_join( map_data('world') ) 



World_data %>%
  ggplot(aes(x = long, y = lat, group = group, fill=log10(Mort_Rate))) +
  geom_polygon( colour = "white") +
  scale_fill_gradient2(low='blue', high='red', midpoint=2,
                       breaks=log10(c(1,10,100)), labels=c(1,10,100) ) +
  labs(x=NULL, y=NULL, 
       title='Maternal Mortality (Deaths per 100,000 births)', 
       fill='Maternal Mortality')


World_data %>%
#  mutate( Mort_Rate = ifelse(Mort_Rate > 100, NA, Mort_Rate) ) %>%
  ggplot(aes(x = long, y = lat, group = group, fill=log10(Mort_Rate))) +
  geom_polygon( colour = "white") +
  scale_fill_gradient2(low='blue', high='red', midpoint=1, breaks=log10(c(1,10,100)), labels=c(1,10,100) ) +
  labs(x=NULL, y=NULL, 
       title='Maternal Mortality (Deaths per 100,000 births)', 
       fill='Maternal Mortality',
       subtitle='Fill color Midpoint set to 10')


World_data %>%
  mutate( Mort_Rate = ifelse(Mort_Rate > 100, 100, Mort_Rate) ) %>%
  ggplot(aes(x = long, y = lat, group = group, fill=log10(Mort_Rate))) +
  geom_polygon( colour = "white") +
  scale_fill_gradient2(low='blue', high='red', midpoint=1, breaks=log10(c(1,10,100)), labels=c(1,10,100) ) +
  labs(x=NULL, y=NULL, 
      fill='Maternal Mortality',
       title='Maternal Mortality (Deaths per 100,000 births)', 
       subtitle = 'Rounded down to 100+')

```


